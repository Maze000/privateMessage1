"mongoose": "^4.12.4",

-----------0--------

espanol

import React, { useState, useEffect } from 'react';

import Logout from './Logout';
import { jwtDecode } from 'jwt-decode'; 
import './consola.css'

const Consola = () => {
    const [users, setUsers] = useState([]);
    const [receiverId, setReceiverId] = useState({id: '', user : ''});
    const [messageContent, setMessageContent] = useState('');
    const [mensajes, setDataContet] = useState([]);
    const [sendDateTime, setSendDateTime] = useState('');

    const token = localStorage.getItem('token');
    let userId = null;
    let userEmail = null;
    if (token) {
        const decoded = jwtDecode(token);
        userId = decoded.userId;
        userEmail = decoded.email;
    }

    useEffect(() => {
        fetchUsers();
    }, []);

    const fetchUsers = () => {
        fetch('/users')
            .then(response => response.json())
            .then(data => setUsers(data))
            .catch(error => console.error('Error al cargar los usuarios:', error));
    };

    
    const handleSendMessage = () => {
        if (!receiverId.id || !messageContent.trim()) {
            alert('Por favor, selecciona un usuario y escribe un mensaje.');
            return;
        }

        if (sendDateTime) {
            
            const formattedDateTime = new Date(sendDateTime).toISOString();
            fetch('/schedule-message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    senderId: userId,
                    receiverId : receiverId.id,
                    content: messageContent,
                    sendDateTime: formattedDateTime,
                }),
            })
                .then(response => response.json())
                .then((data) => {
                    console.log(data.message);
                    setMessageContent('');
                    setSendDateTime('');
                    alert('Mensaje programado con éxito');
                })
                .catch(error => {
                    console.error('Error al programar el mensaje:', error);
                    alert('Error al programar el mensaje');
                });
        } else {
            
            fetch('/send-message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ senderId: userId,receiverId : receiverId.id, content: messageContent }),
            })
                .then(response => response.json())
                .then(() => {
                    setMessageContent('');
                    alert('Mensaje enviado exitosamente');
                })
                .catch(error => {
                    console.error('Error al enviar el mensaje:', error);
                    alert('Error al enviar el mensaje');
                });
        }
    };

    const handleSelectUser = (userId, user) => setReceiverId(prevState => ({ ...prevState, id: userId, user: user }));

    const fetchMessages = () => {
        fetch(`/received-messages/${userId}`, {
            headers: { 'Authorization': `Bearer ${token}` },
        })
            .then(response => response.json())
            .then(data => setDataContet(data))
            .catch(error => console.error('Error al cargar mensajes:', error));
    };


    const mensajesPreescritos = {
        festividades: [
            "Feliz Navidad",
            "Feliz Año Nuevo",
            "Feliz Día del Alumno"
        ],
        amor: [
            "Te amo",
            "Eres lo mejor que me ha pasado",
            "Mi corazón es tuyo"
        ],
        motivación: [
            "Nunca te rindas",
            "Sigue tus sueños",
            "Cree en ti mismo"
        ]
    };
    

    return (
        <div className="container">
            <h1>Private Messenger</h1>

            <div className="section">

                <div>
            <h2>Select Users</h2>
            <div className="user-list">
                {users.map((user) => (
                    <div key={user._id} className="user-item">
                        <button className="button1" onClick={() => handleSelectUser(user._id, user.local.email)}>
                        {user.local.email} 
                            
                        </button>
                        {user.local.email === receiverId.user? 'SELECT': ''}
                    </div>
                ))}
            </div></div>
            <div>
            {userEmail}
            <button className="button2" onClick={fetchMessages}>Box</button>
            <div className="message-list">
                {mensajes.map((message, index) => (
                    <div key={index} className="message-item">
                        <p className="message-content">Mensaje: {message.content}</p>
                        <p className="message-details">De: {message.sender.local.email}</p>
                        <p className="message-details">Enviado: {new Date(message.timestamp).toLocaleString()}</p>
                    </div>
                ))}
            </div></div>

            </div>
            <h2>Fraces</h2>
            <div className="category-list">
                {Object.entries(mensajesPreescritos).map(([categoria, mensajes]) => (
                    <div key={categoria} className="category-item">
                        <h3 className="category-title">{categoria}</h3>
                        {mensajes.map((mensaje, index) => (
                            <button className="button3" key={index} onClick={() => setMessageContent(mensaje)}>
                                {mensaje}
                            </button>
                        ))}
                    </div>
                ))}
            </div>
            <h2>Slecciona y envia tu mensaje</h2>
            
            FOR {receiverId.user}


            <textarea
                value={messageContent}
                onChange={(e) => setMessageContent(e.target.value)}
                placeholder="Escribe tu mensaje aquí"
            />
            <button className="button4" onClick={handleSendMessage}>
                {receiverId.user ?  'Enviar Mensaje': 'No hay Usuario Seleccionado'}
            </button>
            <h3>Programa tu mensaje (opcional)</h3>
            <input
                type="datetime-local"
                value={sendDateTime}
                onChange={(e) => setSendDateTime(e.target.value)}
                placeholder="Fecha y Hora de Envío"
            />
            
            
            
            <div  className="logout-container">
                <Logout />
            </div>
        </div>
    );
};

export default Consola;

--------0------

